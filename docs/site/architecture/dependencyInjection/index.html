<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <meta name="author" content="Joshua Jung">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Dependency Injection - Ringa JS</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">


    <link href="../../extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-108440815-1', 'ringajs.com');
    ga('send', 'pageview');
    </script>
    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">
              <img class="brand-image" src="/img/logo.svg">
            </a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Get Started <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../gettingStarted/demo/">Live Demo</a>
</li>

                        
                            
<li >
    <a href="../../gettingStarted/helloWorld/">Hello World Tutorial</a>
</li>

                        
                            
<li >
    <a href="../../gettingStarted/examples/">Code Examples</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Architecture <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../lifecycle/">Lifecycle</a>
</li>

                        
                            
<li >
    <a href="../events/">Event System *</a>
</li>

                        
                            
<li class="active">
    <a href="./">Dependency Injection</a>
</li>

                        
                            
<li >
    <a href="../debugging/">Debugging *</a>
</li>

                        
                            
<li >
    <a href="../buildingComponentLibraries/">Building Component Libraries *</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Plugins <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../plugins/reactRinga/">react-ringa</a>
</li>

                        
                            
<li >
    <a href="../../plugins/inspector/">Inspector *</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Docs <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../docs/">Index</a>
</li>

                        
                            
<li >
    <a href="../../docs/ringaObject/">RingaObject *</a>
</li>

                        
                            
<li >
    <a href="../../docs/ringaEvent/">RingaEvent *</a>
</li>

                        
                            
<li >
    <a href="../../docs/model/">Model</a>
</li>

                        
                            
<li >
    <a href="../../docs/controller/">Controller *</a>
</li>

                        
                            
<li >
    <a href="../../docs/executors/">Executors *</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Components <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../reactLibrary/introduction/">Introduction *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/examples/">Examples</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/licensing/">Licensing *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/core/">Core *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/arrayCollection/">ArrayCollection *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/ringaComponent/">RingaComponent *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/container/">Container *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/overlays/">Overlays *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/modals/">Modals *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/dragDrop/">Drag and Drop *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/list/">List *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/list/">TextInput *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/list/">NumberInput *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/radioButton/">RadioButton *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/Checkbox/">Checkbox *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/Dropdown/">Dropdown *</a>
</li>

                        
                            
<li >
    <a href="../../reactLibrary/tabNavigator/">TabNavigator *</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../links/">Links</a>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                
                    <li>
                        <a href="https://github.com/joshjung/ringa" target="_blank">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="first-level active"><a href="#dependency-injection">Dependency Injection</a></li>
        
            <li class="second-level"><a href="#1-function-argument-injection">1. Function Argument Injection</a></li>
            
                <li class="third-level"><a href="#11-executor-event-detail-injection">1.1. Executor Event Detail Injection</a></li>
            
                <li class="third-level"><a href="#12-executor-model-injection">1.2. Executor Model Injection</a></li>
            
                <li class="third-level"><a href="#13-event-chaining-and-injections">1.3. Event Chaining and Injections</a></li>
            
                <li class="third-level"><a href="#14-promise-injection">1.4. Promise Injection</a></li>
            
                <li class="third-level"><a href="#15-built-in-injections">1.5. Built in Injections</a></li>
            
                <li class="third-level"><a href="#16-custom-injections">1.6. Custom Injections</a></li>
            
                <li class="third-level"><a href="#17-preparing-for-production-uglify">1.7. Preparing for Production (Uglify)</a></li>
            
        
    
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="dependency-injection">Dependency Injection</h1>
<p><em>Note: make sure you have read and understand everything in the <a href="../../gettingStarted/helloWorld/">Hello World Tutorial</a> before proceeding.</em></p>
<p>Ringa JS currently has two types of dependency injection:</p>
<ul>
<li>Function argument injection by name for Controller executors</li>
<li><a href="../../plugins/reactRinga/">View <code>Model</code> injection through <code>react-ringa</code> Plugin</a></li>
</ul>
<h2 id="1-function-argument-injection">1. Function Argument Injection</h2>
<p>There are several rules that are followed when performing all function injections in Ringa JS:</p>
<ul>
<li>Function injection always injects by name</li>
<li>Order of arguments does not matter</li>
<li>Ringa JS will always warn you in the console if a property could not be found for injection</li>
</ul>
<p>Limitations:</p>
<ul>
<li>You cannot currently use defaults (e.g. <code>(f = 0) =&gt; {}</code>) when performing injections due to the various ways that different transpilers treat this code. I spent a good 4-6 hours trying to figure out how to do this and gave up.</li>
</ul>
<h3 id="11-executor-event-detail-injection">1.1. Executor Event Detail Injection</h3>
<pre><code>import {Controller} from 'ringa'

class MyController extends Controller {
  constructor(name, options) {
    super(name, options);

    this.addListener('saySomething', (message) =&gt; {
      console.log(message);
    });
  }
}

...

import {dispatch} from 'ringa';

dispatch('saySomething', {
  message: 'I will be injected!'
}, document);
</code></pre>
<p>You will notice that the property has been injected by its name <code>message</code>.</p>
<p>Every key in the detail object is available for injection in every executor.</p>
<h3 id="12-executor-model-injection">1.2. Executor <code>Model</code> Injection</h3>
<p>As we have seen in 1.2, executors can request <code>RingaEvent</code> details be injected by their name. Executors can request <code>Model</code> objects be injected by name as well. </p>
<p>Please note that all Ringa JS <code>Model</code> instances by default have their <code>name</code> set to the camelcase of their class name. As a result, when
you create and add a <code>Model</code> to a <code>Controller</code>, that model can be injected by its default name. For example, if your model is named <code>CarModel</code> you can
use <code>addModel</code> to attach the model to your Controller and then inject it by its default camelcase name <code>carModel</code>.</p>
<pre><code>import {Controller, Model} from 'ringa'

const CarModel = Model.construct('CarModel', ['brand', 'type', 'color', 'state']);
const DriverModel = Model.construct('DriverModel', ['name', 'skill']);

class CarController extends Controller {
  constructor(name, options) {
    super(name, options);

    this.addModel(new CarModel());
    this.addModel(new DriverModel('Joshua'));

    this.addListener('startDriving', (carModel) =&gt; {
      carModel.state = 'driving';
    });

    this.addListener('brakeSuddenly', (carModel, Joshua) =&gt; {
      if (Joshua.skill === 0) {
        carModel.state = 'crashed';
      } else {
        carModel.state = 'stopped';
      }
    });
  }
}
</code></pre>
<p>In this example, we see that <code>carModel</code> and <code>Joshua</code> can be injected easily by either the default name or the custom name.</p>
<h3 id="13-event-chaining-and-injections">1.3. Event Chaining and Injections</h3>
<p>In Ringa JS, one <code>Controller</code> executor chain can trigger another. When this happens, all the injections that were available in the original dispatched event are also available in the executors responding to the secondary dispatched event:</p>
<pre><code>import {Controller, Model, event} from 'ringa'

class ConsoleController extends Controller {
  constructor(name, options) {
    super(name, options);

    // Ringa JS automatically creates ConsoleController.LOG
    this.addListener('log', message =&gt; {console.log(message);});
  }
}

class MessageController extends Controller {
  constructor(name, options) {
    super(name, options);

    // Ringa JS automatically creates MessageController.SAY_SOMETHING
    this.addListener('saySomething', event(ConsoleController.LOG));
  }
}

...

// Assuming the above controllers have been attached to the document...
dispatch(MessageController.SAY_SOMETHING, {
  message: 'Woohoo, this gets passed through to ConsoleController!'
}, document);
</code></pre>
<p>One huge architectural advantage of this system is that controllers can function as interfaces to other generic implementations.</p>
<p>But what if there is a name collision somewhere in the chain, like this:</p>
<pre><code>import {Controller, Model, event} from 'ringa'

class ConsoleController extends Controller {
  constructor(name, options) {
    super(name, options);

    this.addListener('log', (message, $ringaEvent, $lastEvent) =&gt; {
      console.log(message);                       // Message 2!
      console.log($ringaEvent.lastEvent.detail.message); // Message 1!
      console.log($lastEvent.detail.message);            // Message 1!
    });
  }
}

class MessageController extends Controller {
  constructor(name, options) {
    super(name, options);

    this.addListener('saySomething', event(ConsoleController.LOG, {
      message: 'Message 2!' // Uh oh, the name 'message' collides with our 'message' below!
    }));
  }
}

...

// Assuming the above controllers have been attached to the document...
dispatch(MessageController.SAY_SOMETHING, {
  message: 'Message 1!'
}, document);
</code></pre>
<p>Ringa JS always retains all contextual information even in a naming conflict. If you dispatch an event that overrides a name that was provided in the original event you can still access the original variable through either <code>$ringaEvent.lastEvent</code> or <code>$lastEvent</code>.</p>
<h3 id="14-promise-injection">1.4. Promise Injection</h3>
<p>Every time you call <code>dispatch()</code> a <code>RingaEvent</code> object is created and returned. The <code>RingaEvent</code> object functions like a promise and you can request injections in your <code>then</code> or <code>catch</code>:</p>
<pre><code>import {Controller, Model, event} from 'ringa'

const UserModel = Model.construct('UserModel', ['name']);

class UserController extends Controller {
  constructor(name, options) {
    super(name, options);

    this.addModel(new UserModel());

    this.addListener('getUser', [
      // Do some complex server call
    ]);
  }
}

...

// userModel is injected because it exists on the handling controller
dispatch(UserController.GET_USER, {}, document).then(userModel =&gt; {
  console.log(`${userModel.name} has been successfully retrieved!`);
});
</code></pre>
<h3 id="15-built-in-injections">1.5. Built in Injections</h3>
<p>Ringa JS by default provides several built-in variables that can be injected at any time:</p>
<ul>
<li><strong><code>$controller</code></strong>: The controller that caught and is currently handling the event.</li>
<li><strong><code>$thread</code></strong>: The internal thread object that is currently managing the executors for the event.</li>
<li><strong><code>$ringaEvent</code></strong>: The original <code>RingaEvent</code> that was dispatched.</li>
<li><strong><code>event</code></strong>: If a DOM event (like <code>click</code> or <code>mouseover</code>) triggered the executor chain, then this would be the DOM event. Note that all DOM events that are caught by Ringa <code>Controller</code> are wrapped in a <code>RingaEvent</code> before the executors are run.</li>
<li><strong><code>$lastEvent</code></strong>: If one <code>RingaEvent</code> chain triggers another (e.g. by using <code>event()</code>) then you can access the prior events via <code>$lastEvent</code>. These are chained together so if an event triggers 3 executor chains, then <code>$lastEvent.lastEvent.lastEvent</code> would be valid.</li>
<li><strong><code>$customEvent</code></strong>: Accesses the DOM <code>CustomEvent</code> object that is used to dispatch the <code>RingaEvent</code> through the DOM nodes.</li>
<li><strong><code>$target</code></strong>: The target DOM node that dispatched the event.</li>
<li><strong><code>$detail</code></strong>: The event detail object. Useful if you want to add new properties or for some reason cannot inject the properties by name.</li>
<li><strong><code>done</code></strong>: Only available in a function executor. A function to call when the executor has been completed. Similar to <code>Mocha</code> or <code>Jest</code> unit tests.</li>
<li><strong><code>fail</code></strong>: Similar to done, except triggers a failure of the executor chain.</li>
<li><strong><code>stop</code></strong>: Useful for debugging. Stops the executor and outputs information to the console, where you can start the executor chain again.</li>
<li><strong><code>resume</code></strong>: Resume the executor chain.</li>
<li><strong><code>$lastPromiseResult</code></strong>: If <em>any</em> previous executor returned a promise that completed, the result will be contained here.</li>
<li><strong><code>$lastPromiseError</code></strong>: If <em>any</em> previous executor returned a promise that errored, the error will be contained here.</li>
</ul>
<h3 id="16-custom-injections">1.6. Custom Injections</h3>
<p>Custom injection values can be added easily to the <code>options.injections</code> object:</p>
<pre><code>import {Controller, Model, event} from 'ringa'

class DudeController extends Controller {
  constructor(name, options) {
    super(name, options);

    this.options.injections.someCustomValue = 'I just have to find a cash machine...';

    this.addListener('doSomething', ...);
  }
}

...

dispatch(DudeController.DO_SOMETHING, {}, document).then(someCustomValue =&gt; {
  console.log(someCustomValue);
});
</code></pre>
<h3 id="17-preparing-for-production-uglify">1.7. Preparing for Production (Uglify)</h3>
<p>When preparing production code, your variable names will be uglified. As a result, you need to add the list of injected variable names to the blacklist for <code>UglifyJS</code>:</p>
<pre><code>plugins: [
  new webpack.DefinePlugin({
    __DEV__: false
  }),
  new webpack.optimize.UglifyJsPlugin({
    sourceMap: true,
    mangle: {
      except: [
        '$controller',
        '$thread',
        '$ringaEvent',
        'event',
        '$customEvent',
        '$lastEvent',
        '$target',
        '$detail',
        'done',
        'fail',
        '$lastPromiseResult',
        '$lastPromiseError'
        ...]
    }
  })
]
</code></pre>
<p>But how do you know what they are?</p>
<p>When in <code>__DEV__: true</code> mode, Ringa JS keeps track of every single variable that has been injected and builds a whilelist for you.</p>
<p><strong>To view all the injections you need to add to the <code>mangle</code> property of <code>UglifyJS</code>, after you have run your application and all of its various executors go to the browser console:</strong></p>
<p><img src="/img/uglifywhitelist.png" alt="ringaDebug().uglifywhitelist" style="width: 100%;"/></p>
<p>Please note that because a lot of the injections that can occur in Ringa JS are dynamic, it is impossible to know before running each executor which variable names will need to avoid mangling.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>© 2017 Joshua Jung and the Ringa JS Team<br></small>
        
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
